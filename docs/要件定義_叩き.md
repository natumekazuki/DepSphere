要件定義書：3D依存ネットワーク可視化ツール（Windows特化）

1. 背景・目的

1.1 背景
	•	コーディングエージェントが生成した大規模コード（C#ライブラリ）を、Visual Studioの手作業追跡だけで把握するのが困難になっている。
	•	「依存関係の全体像」と「読むべきホットスポット」を短時間で掴む必要がある。

1.2 目的
	•	ライブラリ範囲内の構造を、3Dの依存ネットワークとして視覚化し、探索可能にする。
	•	同一UIで、**ホットスポット（複雑/巨大/中心度高い箇所）**も把握できる状態にする。
	•	“読む順”や“修正影響範囲”の判断を高速化し、レビュー/保守/リファクタのコストを下げる。

1.3 成果物の定義
	•	Windows上で動作するGUIアプリ
	•	C#ソリューション（またはcsproj）を解析し、3D表示で依存探索できる
	•	メトリクス（ホットスポット指標）を可視化できる
	•	解析結果/表示状態を保存・再利用できる

⸻

2. 対象範囲（スコープ）

2.1 対象
	•	C#（.NET）ライブラリを主対象とする
	•	解析対象の単位：
	•	ソリューション（.sln）
	•	プロジェクト（.csproj）
	•	生成後のコード（エージェント生成を含む）

2.2 対象外（初期リリース）
	•	実行時プロファイル（トレース、実行ログ連携）
	•	完全なメソッド呼び出し解決（DI/仮想呼び出し/反射などまで100%精密）
	•	C#以外の言語（VBなどは将来検討）

⸻

3. ユースケース

UC-01：ライブラリ全体の依存構造を俯瞰
	•	入力：.sln または .csproj
	•	出力：Assembly/Namespace/Type の依存ネットワーク（3D）
	•	成功条件：主要な層/塊が見える、クリックで詳細展開できる

UC-02：ある型（または公開API）を起点に影響範囲を探索
	•	起点：public型 / 特定namespace / 特定クラス名
	•	操作：近傍展開、in/out依存切替、ハイライト
	•	成功条件：依存方向を誤解なく辿れる

UC-03：ホットスポットを発見して読む順を決める
	•	指標：LOC、Cyclomatic Complexity（または近似）、依存中心度、循環依存所属など
	•	表示：ノード色/サイズ/発光/ラベル
	•	成功条件：上位N件のホットスポット一覧と、グラフ上強調が一致する

UC-04：状態保存と再現
	•	解析結果キャッシュ、フィルタ/カメラ位置/選択ノードを保存
	•	成功条件：次回起動で同じ視点から探索を再開できる

⸻

4. 機能要件

4.1 入力・解析

FR-01：プロジェクト読み込み
	•	.sln / .csproj を選択して解析を開始できる
	•	解析範囲を「ライブラリ内（指定プロジェクト群）」に限定できる

FR-02：解析モード
	•	Type依存（必須）
	•	参照/利用（フィールド型、引数型、戻り値型、new、静的参照など）
	•	継承/実装（base class / interface）
	•	Optional：メソッド呼び出し（段階導入）
	•	直接呼び出しのみ（最初は保守的推定でよい）
	•	不確実な解決は「推定」表示 or 除外設定可能

FR-03：ノード階層
	•	表示粒度を切替できる
	•	Assemblyレベル
	•	Namespaceレベル
	•	Typeレベル
	•	粒度切替時も、同じ探索意図が保たれる（選択対象の引き継ぎ）

⸻

4.2 3D可視化・操作

FR-10：3Dネットワーク表示
	•	ノード：対象粒度（Assembly/Namespace/Type）
	•	エッジ：依存関係（方向性を持つ）
	•	操作：回転/ズーム/パン/フォーカス

FR-11：探索操作
	•	検索（名前、namespace、正規表現、部分一致）
	•	フィルタ
	•	publicのみ
	•	特定namespace除外
	•	依存種別（継承のみ、参照のみ など）
	•	近傍展開
	•	In依存（参照される側）
	•	Out依存（参照する側）
	•	深さ（1〜N）
	•	経路表示
	•	A→Bの依存経路（可能な範囲で最短経路）を強調

FR-12：表示の読みやすさ
	•	ラベルのオン/オフ、表示数制限
	•	ノードのクラスタリング（大規模時に必須）
	•	折りたたみ/展開（塊ごとの開閉）

⸻

4.3 ホットスポット可視化

FR-20：メトリクス算出
最低限（MVP）
	•	LOC（行数）
	•	依存中心度（in-degree / out-degree）
	•	ファイル数/型数（上位粒度時）

推奨（実用）
	•	循環依存への所属（強連結成分）
	•	複雑度（Cyclomatic Complexityまたは近似）
	•	変更頻度（Git連携が可能なら：コミット回数/直近変更日）※任意

FR-21：ホットスポット表示
	•	ノードの色/サイズ等にメトリクスを割り当て可能
	•	ホットスポットランキング（上位N件）を別ペイン表示
	•	ランキングクリックで該当ノードへカメラ移動・強調

⸻

4.4 出力・共有

FR-30：エクスポート
	•	画像（スクリーンショット）
	•	解析結果（JSON等）エクスポート
	•	レポート出力（ホットスポット上位、循環依存一覧、主要クラスター）

FR-31：状態保存
	•	ワークスペース保存（対象パス、解析設定、フィルタ、視点、選択ノード）
	•	再読み込み時の差分更新（可能なら）

⸻

5. 非機能要件

5.1 性能
	•	解析時間（目標）：中規模で数十秒以内（※規模パラメータ化）
	•	表示性能：一定規模以上はクラスタリング/LODで操作を維持
	•	メモリ：解析キャッシュ込みで実用範囲

5.2 信頼性・正確性
	•	依存解析は「確定」と「推定」を区別して扱える
	•	不確実な解析結果がユーザー判断を誤らせないUI（凡例・表記）

5.3 互換性
	•	Windows 10/11（必須）
	•	.NET SDKのバージョン差異による解析の安定性を確保（Roslyn利用を前提）

5.4 セキュリティ
	•	ローカル解析が基本（外部送信なし）
	•	ワークスペースや解析結果に機密が含まれる可能性があるため、保存先を明示

⸻

6. UI要件（画面仕様）

6.1 画面構成（例）
	•	左：プロジェクトツリー/検索/フィルタ
	•	中央：3Dビュー（メイン）
	•	右：詳細ペイン（選択ノードの依存、メトリクス、関連ファイル）
	•	下：ホットスポットランキング/循環依存一覧/ログ

6.2 主要操作
	•	ダブルクリック：ノードにフォーカス
	•	Shift+クリック：複数選択
	•	ホイール：ズーム、ドラッグ：回転/パン
	•	検索→Enter：最初の一致へジャンプ、候補一覧から選択可能

⸻

7. システム構成（論理）

7.1 モジュール
	•	Analyzer（Roslyn解析）
	•	GraphModel（ノード/エッジ、メトリクス）
	•	Renderer（3D描画：WebGL/Three.js 等）
	•	UI Host（WebView2 など）
	•	Persistence（ワークスペース/キャッシュ保存）

7.2 データモデル（概略）
	•	Node
	•	id, kind(assembly/namespace/type), name, fullyQualifiedName
	•	metrics: loc, indeg, outdeg, complexity?, cycleGroup?
	•	tags: public/internal, generated?, etc
	•	Edge
	•	fromId, toId, kind(reference/inherit/implement/call?), confidence(certain/estimated)

⸻

8. 受入基準（Acceptance Criteria）

MVP受入
	•	(A1) .slnを指定して解析→3Dグラフ表示ができる
	•	(A2) Type依存で In/Out を辿れる（深さ1〜2で十分）
	•	(A3) 検索・フィルタ・ハイライト・フォーカスが直感的に動く
	•	(A4) LOC/中心度を色またはサイズに反映し、ホットスポット上位Nが表示される
	•	(A5) ワークスペース保存/再開ができる

実用受入（次フェーズ）
	•	(B1) 大規模時にクラスタリング/折りたたみで操作が破綻しない
	•	(B2) 循環依存が一覧＋グラフ強調で分かる
	•	(B3) 粒度（Assembly/Namespace/Type）切替が実用的

⸻

9. 開発計画（目安）

Phase 0：プロトタイプ（1〜2週）
	•	Roslynで型依存抽出（最小）
	•	3D表示（固定データでも可）で操作性検証

Phase 1：MVP（3〜6週）
	•	解析→3D表示→探索→メトリクス→保存まで通す

Phase 2：実用化（+4〜8週）
	•	大規模最適化（クラスタリング/LOD）
	•	循環依存・レイヤ支援
	•	エクスポート/レポート

⸻

10. リスク・課題
	•	コールグラフの正確性：C#の動的要素（DI/仮想/反射）で爆発しやすい
→ 初期は「型依存中心」「推定は明示」「任意導入」
	•	表示スケール：ノード数が増えると3Dが破綻
→ 粒度切替、クラスタリング、表示制限を必須要件扱い
	•	生成コードのノイズ：自動生成/Source Generator等の扱い
→ “generated扱いの除外/薄色化”オプションを検討

⸻

11. 参考（用語）
	•	依存ネットワーク：型/名前空間/アセンブリ間の参照関係を有向グラフで表したもの
	•	ホットスポット：巨大・複雑・依存中心・循環所属など、理解/保守コストが高い部分
